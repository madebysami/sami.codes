---
import { getCollection } from 'astro:content'
import BaseLayout from '../layouts/BaseLayout.astro'
import Hero from '../components/Hero.astro'
import SocialLinks from '../components/SocialLinks.astro'
import TechStack from '../components/TechStack.astro'
import JumpGame from '../components/JumpGame.astro'

const posts = (await getCollection('blog'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3)
---

<BaseLayout title="Home" isHomepage>
  <Hero />
  <SocialLinks />
  <TechStack />

  <!-- Projects -->
  <section aria-labelledby="projects-heading" class="w-full">
    <h2
      id="projects-heading"
      class="text-xs uppercase tracking-widest font-bold mb-6 font-mono text-brand"
    >
      Output
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
      <a
        href="https://card.sami.codes"
        target="_blank"
        rel="noopener noreferrer"
        class="block group h-full"
      >
        <div
          class="tech-card rounded-lg p-6 h-full flex flex-col bg-surface border border-brand/20 transition-all duration-300 hover:-translate-y-1 hover:border-brand hover:shadow-lg hover:shadow-brand/20"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="w-8 h-8 mb-4 text-brand"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5zm6-10.125a1.875 1.875 0 1 1-3.75 0 1.875 1.875 0 0 1 3.75 0zm1.294 6.336a6.721 6.721 0 0 1-3.17.789 6.721 6.721 0 0 1-3.168-.789 3.376 3.376 0 0 1 6.338 0z"
            ></path>
          </svg>
          <h3
            class="text-lg font-bold mb-2 group-hover:underline text-text-primary"
          >
            Developer Card
          </h3>
          <p class="text-sm mb-4 text-text-secondary flex-grow">
            A digital business card and link-in-bio page.
          </p>
          <ul
            class="flex gap-2 font-mono text-xs flex-wrap text-brand list-none p-0 m-0 mb-4"
            role="list"
          >
            <li>Astro</li>
            <li>Tailwind CSS</li>
          </ul>
          <div class="font-mono text-xs text-brand mt-auto">View Project ↗</div>
        </div>
      </a>
    </div>

    <div
      class="text-sm text-text-secondary font-mono border-l-2 border-brand/50 pl-4 py-3 bg-surface-alt/50 rounded-r"
    >
      &gt; Initiating cargo run --release...<br />
      &gt; Compiling side-projects (2/42)...<br />
      &gt; Wait, who wrote this legacy spaghetti code?<br />
      <span class="text-brand inline-block mt-2 animate-pulse"
        >_ Building in progress. Check back soon.</span
      >
    </div>
  </section>

  <!-- Transmissions / Blog -->
  <section aria-labelledby="blog-heading" class="w-full">
    <div class="flex items-center justify-between mb-6">
      <h2
        id="blog-heading"
        class="text-xs uppercase tracking-widest font-bold font-mono text-brand"
      >
        Transmissions
      </h2>
      <a
        href="/blog"
        class="text-xs font-mono text-text-secondary hover:text-brand transition-colors"
      >
        View All ↗
      </a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {
        posts.map((post) => (
          <a href={`/blog/${post.slug}`} class="block group h-full">
            <div class="tech-card rounded-lg p-6 h-full flex flex-col bg-surface border border-brand/20 transition-all duration-300 hover:-translate-y-1 hover:border-brand hover:shadow-lg hover:shadow-brand/20">
              <time
                datetime={post.data.pubDate.toISOString()}
                class="text-xs font-mono text-text-secondary mb-2 block"
              >
                {post.data.pubDate.toLocaleDateString('en-GB', {
                  year: 'numeric',
                  month: 'numeric',
                  day: 'numeric',
                })}
              </time>
              <h3 class="text-lg font-bold mb-2 group-hover:underline text-text-primary line-clamp-2">
                {post.data.title}
              </h3>
              <p class="text-sm mb-4 text-text-secondary flex-grow line-clamp-3">
                {post.data.description}
              </p>
              <ul
                class="flex gap-2 font-mono text-xs flex-wrap text-brand list-none p-0 m-0"
                role="list"
              >
                {post.data.tags.slice(0, 3).map((tag: string) => (
                  <li>{tag}</li>
                ))}
              </ul>
            </div>
          </a>
        ))
      }
    </div>
  </section>

  <JumpGame />
</BaseLayout>
