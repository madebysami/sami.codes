---
import { getCollection } from 'astro:content'
import BaseLayout from '../layouts/BaseLayout.astro'
import Hero from '../components/Hero.astro'
import SocialLinks from '../components/SocialLinks.astro'
import TechStack from '../components/TechStack.astro'
import JumpGame from '../components/JumpGame.astro'

const posts = (await getCollection('blog'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3)
---

<BaseLayout title="Home">
  <Hero />
  <SocialLinks />
  <TechStack />

  <!-- Projects -->
  <section aria-labelledby="projects-heading" class="w-full">
    <h2
      id="projects-heading"
      class="text-xs uppercase tracking-widest font-bold mb-6 font-mono text-brand"
    >
      Output
    </h2>

    <div
      class="text-sm text-text-secondary font-mono border-l-2 border-brand/50 pl-4 py-3 bg-surface-alt/50 rounded-r"
    >
      > Initiating cargo run --release...<br />
      > Compiling side-projects (1/42)...<br />
      > Wait, who wrote this legacy spaghetti code?<br />
      <span class="text-brand inline-block mt-2 animate-pulse"
        >_ Building in progress. Check back soon.</span
      >
    </div>
  </section>

  <!-- Transmissions / Blog -->
  <section aria-labelledby="blog-heading" class="w-full">
    <div class="flex items-center justify-between mb-6">
      <h2
        id="blog-heading"
        class="text-xs uppercase tracking-widest font-bold font-mono text-brand"
      >
        Transmissions
      </h2>
      <a
        href="/blog"
        class="text-xs font-mono text-text-secondary hover:text-brand transition-colors"
      >
        View All â†—
      </a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {
        posts.map((post) => (
          <a href={`/blog/${post.slug}`} class="block group h-full">
            <div class="tech-card rounded-lg p-6 h-full flex flex-col bg-surface border border-brand/20 transition-all duration-300 hover:-translate-y-1 hover:border-brand hover:shadow-lg hover:shadow-brand/20">
              <time
                datetime={post.data.pubDate.toISOString()}
                class="text-xs font-mono text-text-secondary mb-2 block"
              >
                {post.data.pubDate.toLocaleDateString('en-GB', {
                  year: 'numeric',
                  month: 'numeric',
                  day: 'numeric',
                })}
              </time>
              <h3 class="text-lg font-bold mb-2 group-hover:underline text-text-primary line-clamp-2">
                {post.data.title}
              </h3>
              <p class="text-sm mb-4 text-text-secondary flex-grow line-clamp-3">
                {post.data.description}
              </p>
              <ul
                class="flex gap-2 font-mono text-xs flex-wrap text-brand list-none p-0 m-0"
                role="list"
              >
                {post.data.tags.slice(0, 3).map((tag: string) => (
                  <li>{tag}</li>
                ))}
              </ul>
            </div>
          </a>
        ))
      }
    </div>
  </section>

  <JumpGame />
</BaseLayout>
