---
import { getCollection } from 'astro:content'
import BaseLayout from '../../layouts/BaseLayout.astro'

export async function getStaticPaths() {
  const posts = await getCollection('blog')
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }))
}

const post = Astro.props
const { Content } = await post.render()
---

<BaseLayout
  title={post.data.title}
  description={post.data.description}
  canonicalURL={`https://sami.codes/blog/${post.slug}`}
  article={{
    publishedTime: post.data.pubDate.toISOString(),
    tags: post.data.tags,
  }}
>
  <article class="w-full">
    <div class="mb-8">
      <a
        href="/blog"
        class="block mb-6 text-sm font-mono text-brand hover:underline"
      >
        cd ../
      </a>
      <h1 class="text-3xl md:text-4xl font-bold text-text-primary mb-4">
        {post.data.title}
      </h1>
      <div
        class="flex flex-col sm:flex-row sm:items-center gap-4 text-sm font-mono text-text-secondary"
      >
        <time datetime={post.data.pubDate.toISOString()}>
          {
            post.data.pubDate.toLocaleDateString('en-GB', {
              year: 'numeric',
              month: 'long',
              day: 'numeric',
            })
          }
        </time>
        <ul
          class="flex gap-2 flex-wrap text-brand list-none p-0 m-0"
          role="list"
        >
          {post.data.tags.map((tag: string) => <li>{tag}</li>)}
        </ul>
      </div>
    </div>

    <!-- 
      Tailwind Typography (.prose) integration with custom theme variables. 
      The default prose colors are overridden to inherit our dynamic CSS map.
    -->
    <div
      class="prose prose-slate max-w-none prose-headings:text-text-primary prose-headings:font-bold prose-p:text-text-secondary prose-p:leading-relaxed prose-a:text-brand prose-a:transition-colors hover:prose-a:text-brand/80 prose-strong:text-text-primary prose-strong:font-bold prose-code:text-brand prose-code:bg-surface-alt prose-code:px-1 prose-code:rounded prose-code:before:content-none prose-code:after:content-none prose-pre:bg-surface-alt prose-pre:border prose-pre:border-brand/20 prose-ul:text-text-secondary prose-li:text-text-secondary prose-li:marker:text-brand prose-blockquote:border-l-brand prose-blockquote:text-text-secondary prose-blockquote:bg-surface-alt/50 prose-blockquote:px-4 prose-blockquote:py-1 prose-blockquote:rounded-r prose-img:rounded-lg prose-img:border prose-img:border-brand/20 prose-hr:border-brand/20"
    >
      <Content />
    </div>
  </article>
</BaseLayout>
